<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <title>Väike Veebimeister</title>
    <style>
        body {
            margin: 0; padding: 0; display: flex; height: 100vh;
            font-family: 'Comic Sans MS', sans-serif; background-color: #f4f4f4;
            overflow: hidden; flex-direction: column;
        }

        /* Ülemine tööriistariba */
        .toolbar {
            background: #fff; padding: 10px 20px;
            display: flex; align-items: center; gap: 15px;
            border-bottom: 2px solid #ddd;
        }

        .color-picker-label { font-weight: bold; color: #555; }
        input[type="color"] { cursor: pointer; border: none; width: 40px; height: 40px; border-radius: 50%; }

        /* Põhiala */
        .main-view { display: flex; flex: 1; overflow: hidden; }

        .editor-side, .preview-side {
            flex: 1; display: flex; flex-direction: column; padding: 15px;
        }

        label { color: #888; margin-bottom: 5px; font-size: 14px; text-transform: uppercase; }

        textarea {
            flex: 1; background-color: #282c34; color: #98c379;
            border-radius: 10px; padding: 20px; font-size: 18px;
            font-family: 'Courier New', monospace; resize: none; outline: none;
            line-height: 1.5; border: 5px solid #3e4451;
        }

        iframe {
            flex: 1; border: 5px solid #fff; border-radius: 10px;
            background-color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .highlight-msg { font-size: 12px; color: #aaa; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="toolbar">
        <span class="color-picker-label">Vali taustavärv:</span>
        <input type="color" id="bgColorPicker" value="#add8e6" oninput="changeBg(this.value)">
        <span style="color: #888; font-size: 14px;"></span>
    </div>

    <div class="main-view">
        <div class="editor-side">
            <label>Sinu kood:</label>
            <textarea id="editor" oninput="update()" spellcheck="false">
<body style="background-color: #add8e6; text-align: center;">

  <h1 style="color: #2c3e50;">Olen imeline leht</h1>

  <p>Tere! Mina olen väike veebileht.</p>

  <p>Siin on minu koer:</p>

  <img src="https://placedog.net/400/300" width="250">

  <p>Veel juttu:)</p>

</body></textarea>
            <div class="highlight-msg">Nipp: kliki paremal asju, et need koodist leida!</div>
        </div>

        <div class="preview-side">
            <label>Sinu veebileht:</label>
            <iframe id="preview"></iframe>
        </div>
    </div>

<script>
    const editor = document.getElementById('editor');
    const preview = document.getElementById('preview');

    function update() {
        const content = editor.value;
        const iframeDoc = preview.contentWindow.document;

        iframeDoc.open();
        iframeDoc.write(content);

        // Skript, mis saadab info klikitud elemendi kohta
        iframeDoc.write(`
            <script>
                document.body.onclick = function(e) {
                    if (e.target !== document.body) {
                        let info = {
                            text: e.target.innerText,
                            html: e.target.outerHTML,
                            tagName: e.target.tagName,
                            src: e.target.src
                        };
                        window.parent.postMessage(info, "*");
                    }
                };
            <\/script>
        `);
        iframeDoc.close();
    }

    // Taustavärvi muutmine koodis
    function changeBg(color) {
        let code = editor.value;
        // Otsime üles background-color osa ja asendame selle
        const newCode = code.replace(/background-color: #[a-fA-F0-9]{6}|background-color: [a-z]+/, `background-color: ${color}`);
        editor.value = newCode;
        update();
    }

    // Klikkimise tuvastamine
    window.addEventListener('message', function(event) {
        const data = event.data;
        const code = editor.value;
        let searchString = "";

        if (data.tagName === "IMG") {
            // Kui on pilt, otsime ainult src sisu (aadressi)
            // Võtame pildi aadressi lõpuosa, et otsing oleks täpsem
            const url = new URL(data.src);
            searchString = url.pathname.substring(url.pathname.lastIndexOf('/') + 1);

            // Otsime koodist üles pildi nime
            const index = code.indexOf(searchString);
            if (index !== -1) {
                editor.focus();
                // Märgime ära kogu src jutumärkide vahel
                const start = code.lastIndexOf('"', index);
                const end = code.indexOf('"', index);
                editor.setSelectionRange(start + 1, end);
            }
        } else {
            // Kui on tekst, märgime teksti
            searchString = data.text.trim();
            const index = code.indexOf(searchString);
            if (index !== -1) {
                editor.focus();
                editor.setSelectionRange(index, index + searchString.length);
            }
        }
    });

    window.onload = update;
</script>

</body>
</html>